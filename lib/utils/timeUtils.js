'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.timeSnap = timeSnap;
exports.pixelsPerMinute = pixelsPerMinute;
exports.getSnapPixelFromDelta = getSnapPixelFromDelta;
exports.getTimeAtPixel = getTimeAtPixel;
exports.getPixelAtTime = getPixelAtTime;
exports.getDurationFromPixels = getDurationFromPixels;

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Snaps a moment object to the given resolution
 * @param {moment} time The moment to snap
 * @param {number} snapSeconds The snap time in seconds
 * @returns {moment} Snapped moment
 */
function timeSnap(time, snapSeconds) {
  if (snapSeconds === 0) {
    var newTime = time.clone();
    newTime.set('millisecond', 0);
    return newTime;
  }
  var newUnix = Math.round(time.unix() / snapSeconds) * snapSeconds;
  return (0, _moment2.default)(newUnix * 1000);
}

/**
 * Get the pixels per minute
 * @param {moment} vis_start The moment specifying the start of the visible timeline range
 * @param {moment} vis_end The moment specifying the end of the visible timeline range
 * @param {number} total_width The width of the timeline in pixels
 * @returns {float} The pixels per minute
 */
// Time utilities

function pixelsPerMinute(vis_start, vis_end, total_width) {
  var start_end_min = vis_end.diff(vis_start, 'minutes');
  return total_width / start_end_min;
}

/**
 *
 * @param {number} delta the delta distance in pixels
 * @param {moment} vis_start the visible start of the timeline
 * @param {moment} vis_end  the visible end of the timeline
 * @param {number} total_width  the pixel width of the timeline
 * @param {number} snapMinutes the number of minutes to snap to
 */
function getSnapPixelFromDelta(delta, vis_start, vis_end, total_width) {
  var snapMinutes = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;

  var pixelsPerSnapSegment = pixelsPerMinute(vis_start, vis_end, total_width) * snapMinutes;
  return Math.round(delta / pixelsPerSnapSegment) * pixelsPerSnapSegment;
}

/**
 * Get the time at a pixel location
 * @param {number} pixel_location the pixel location (generally from left css style)
 * @param {moment} vis_start The visible start of the timeline
 * @param {moment} vis_end The visible end of the timeline
 * @param {number} total_width The pixel width of the timeline (row portion)
 * @param {number} snapMinutes The snap resolution (in mins)
 * @returns {moment} Moment object
 */
function getTimeAtPixel(pixel_location, vis_start, vis_end, total_width) {
  var snapMinutes = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;

  var min_offset = pixel_location / pixelsPerMinute(vis_start, vis_end, total_width);
  var timeAtPix = vis_start.clone().add(min_offset, 'minutes');
  if (snapMinutes !== 0) timeAtPix = timeSnap(timeAtPix, snapMinutes * 60);
  return timeAtPix;
}
/**
 * Get the pixel location at a specific time
 * @param  {objects} time The time (moment) object
 * @param  {moment} vis_start The visible start of the timeline
 * @param  {moment} vis_end The visible end of the timeline
 * @param  {number} total_width The width in pixels of the grid
 * @returns {number} The pixel offset
 */
function getPixelAtTime(time, vis_start, vis_end, total_width) {
  var min_from_start = time.diff(vis_start, 'minutes');
  return min_from_start * pixelsPerMinute(vis_start, vis_end, total_width);
}
/**
 * Returns the duration from the {@link vis_start}
 * @param  {number} pixels
 * @param  {moment} vis_start The visible start of the timeline
 * @param  {moment} vis_end The visible end of the timeline
 * @param  {number} total_width The width in pixels of the grid
 * @returns {moment} Moment duration
 */
function getDurationFromPixels(pixels, vis_start, vis_end, total_width) {
  var start_end_min = vis_end.diff(vis_start, 'minutes');
  if (start_end_min === 0) return _moment2.default.duration(0, 'minutes');
  var pixels_per_min = total_width / start_end_min;
  var mins = pixels / pixels_per_min;
  return _moment2.default.duration(mins, 'minutes');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy90aW1lVXRpbHMuanMiXSwibmFtZXMiOlsidGltZVNuYXAiLCJwaXhlbHNQZXJNaW51dGUiLCJnZXRTbmFwUGl4ZWxGcm9tRGVsdGEiLCJnZXRUaW1lQXRQaXhlbCIsImdldFBpeGVsQXRUaW1lIiwiZ2V0RHVyYXRpb25Gcm9tUGl4ZWxzIiwidGltZSIsInNuYXBTZWNvbmRzIiwibmV3VGltZSIsImNsb25lIiwic2V0IiwibmV3VW5peCIsIk1hdGgiLCJyb3VuZCIsInVuaXgiLCJ2aXNfc3RhcnQiLCJ2aXNfZW5kIiwidG90YWxfd2lkdGgiLCJzdGFydF9lbmRfbWluIiwiZGlmZiIsImRlbHRhIiwic25hcE1pbnV0ZXMiLCJwaXhlbHNQZXJTbmFwU2VnbWVudCIsInBpeGVsX2xvY2F0aW9uIiwibWluX29mZnNldCIsInRpbWVBdFBpeCIsImFkZCIsIm1pbl9mcm9tX3N0YXJ0IiwicGl4ZWxzIiwibW9tZW50IiwiZHVyYXRpb24iLCJwaXhlbHNfcGVyX21pbiIsIm1pbnMiXSwibWFwcGluZ3MiOiI7Ozs7O1FBVWdCQSxRLEdBQUFBLFE7UUFpQkFDLGUsR0FBQUEsZTtRQWFBQyxxQixHQUFBQSxxQjtRQWNBQyxjLEdBQUFBLGM7UUFjQUMsYyxHQUFBQSxjO1FBWUFDLHFCLEdBQUFBLHFCOztBQTlFaEI7Ozs7OztBQUVBOzs7Ozs7QUFNTyxTQUFTTCxRQUFULENBQWtCTSxJQUFsQixFQUF3QkMsV0FBeEIsRUFBcUM7QUFDMUMsTUFBSUEsZ0JBQWdCLENBQXBCLEVBQXVCO0FBQ3JCLFFBQU1DLFVBQVVGLEtBQUtHLEtBQUwsRUFBaEI7QUFDQUQsWUFBUUUsR0FBUixDQUFZLGFBQVosRUFBMkIsQ0FBM0I7QUFDQSxXQUFPRixPQUFQO0FBQ0Q7QUFDRCxNQUFNRyxVQUFVQyxLQUFLQyxLQUFMLENBQVdQLEtBQUtRLElBQUwsS0FBY1AsV0FBekIsSUFBd0NBLFdBQXhEO0FBQ0EsU0FBTyxzQkFBT0ksVUFBVSxJQUFqQixDQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7QUFwQkE7O0FBMkJPLFNBQVNWLGVBQVQsQ0FBeUJjLFNBQXpCLEVBQW9DQyxPQUFwQyxFQUE2Q0MsV0FBN0MsRUFBMEQ7QUFDL0QsTUFBTUMsZ0JBQWdCRixRQUFRRyxJQUFSLENBQWFKLFNBQWIsRUFBd0IsU0FBeEIsQ0FBdEI7QUFDQSxTQUFPRSxjQUFjQyxhQUFyQjtBQUNEOztBQUVEOzs7Ozs7OztBQVFPLFNBQVNoQixxQkFBVCxDQUErQmtCLEtBQS9CLEVBQXNDTCxTQUF0QyxFQUFpREMsT0FBakQsRUFBMERDLFdBQTFELEVBQXdGO0FBQUEsTUFBakJJLFdBQWlCLHVFQUFILENBQUc7O0FBQzdGLE1BQU1DLHVCQUF1QnJCLGdCQUFnQmMsU0FBaEIsRUFBMkJDLE9BQTNCLEVBQW9DQyxXQUFwQyxJQUFtREksV0FBaEY7QUFDQSxTQUFPVCxLQUFLQyxLQUFMLENBQVdPLFFBQVFFLG9CQUFuQixJQUEyQ0Esb0JBQWxEO0FBQ0Q7O0FBRUQ7Ozs7Ozs7OztBQVNPLFNBQVNuQixjQUFULENBQXdCb0IsY0FBeEIsRUFBd0NSLFNBQXhDLEVBQW1EQyxPQUFuRCxFQUE0REMsV0FBNUQsRUFBMEY7QUFBQSxNQUFqQkksV0FBaUIsdUVBQUgsQ0FBRzs7QUFDL0YsTUFBSUcsYUFBYUQsaUJBQWlCdEIsZ0JBQWdCYyxTQUFoQixFQUEyQkMsT0FBM0IsRUFBb0NDLFdBQXBDLENBQWxDO0FBQ0EsTUFBSVEsWUFBWVYsVUFBVU4sS0FBVixHQUFrQmlCLEdBQWxCLENBQXNCRixVQUF0QixFQUFrQyxTQUFsQyxDQUFoQjtBQUNBLE1BQUlILGdCQUFnQixDQUFwQixFQUF1QkksWUFBWXpCLFNBQVN5QixTQUFULEVBQW9CSixjQUFjLEVBQWxDLENBQVo7QUFDdkIsU0FBT0ksU0FBUDtBQUNEO0FBQ0Q7Ozs7Ozs7O0FBUU8sU0FBU3JCLGNBQVQsQ0FBd0JFLElBQXhCLEVBQThCUyxTQUE5QixFQUF5Q0MsT0FBekMsRUFBa0RDLFdBQWxELEVBQStEO0FBQ3BFLE1BQU1VLGlCQUFpQnJCLEtBQUthLElBQUwsQ0FBVUosU0FBVixFQUFxQixTQUFyQixDQUF2QjtBQUNBLFNBQU9ZLGlCQUFpQjFCLGdCQUFnQmMsU0FBaEIsRUFBMkJDLE9BQTNCLEVBQW9DQyxXQUFwQyxDQUF4QjtBQUNEO0FBQ0Q7Ozs7Ozs7O0FBUU8sU0FBU1oscUJBQVQsQ0FBK0J1QixNQUEvQixFQUF1Q2IsU0FBdkMsRUFBa0RDLE9BQWxELEVBQTJEQyxXQUEzRCxFQUF3RTtBQUM3RSxNQUFNQyxnQkFBZ0JGLFFBQVFHLElBQVIsQ0FBYUosU0FBYixFQUF3QixTQUF4QixDQUF0QjtBQUNBLE1BQUlHLGtCQUFrQixDQUF0QixFQUF5QixPQUFPVyxpQkFBT0MsUUFBUCxDQUFnQixDQUFoQixFQUFtQixTQUFuQixDQUFQO0FBQ3pCLE1BQU1DLGlCQUFpQmQsY0FBY0MsYUFBckM7QUFDQSxNQUFJYyxPQUFPSixTQUFTRyxjQUFwQjtBQUNBLFNBQU9GLGlCQUFPQyxRQUFQLENBQWdCRSxJQUFoQixFQUFzQixTQUF0QixDQUFQO0FBQ0QiLCJmaWxlIjoidGltZVV0aWxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGltZSB1dGlsaXRpZXNcclxuXHJcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuXHJcbi8qKlxyXG4gKiBTbmFwcyBhIG1vbWVudCBvYmplY3QgdG8gdGhlIGdpdmVuIHJlc29sdXRpb25cclxuICogQHBhcmFtIHttb21lbnR9IHRpbWUgVGhlIG1vbWVudCB0byBzbmFwXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzbmFwU2Vjb25kcyBUaGUgc25hcCB0aW1lIGluIHNlY29uZHNcclxuICogQHJldHVybnMge21vbWVudH0gU25hcHBlZCBtb21lbnRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB0aW1lU25hcCh0aW1lLCBzbmFwU2Vjb25kcykge1xyXG4gIGlmIChzbmFwU2Vjb25kcyA9PT0gMCkge1xyXG4gICAgY29uc3QgbmV3VGltZSA9IHRpbWUuY2xvbmUoKTtcclxuICAgIG5ld1RpbWUuc2V0KCdtaWxsaXNlY29uZCcsIDApO1xyXG4gICAgcmV0dXJuIG5ld1RpbWU7XHJcbiAgfVxyXG4gIGNvbnN0IG5ld1VuaXggPSBNYXRoLnJvdW5kKHRpbWUudW5peCgpIC8gc25hcFNlY29uZHMpICogc25hcFNlY29uZHM7XHJcbiAgcmV0dXJuIG1vbWVudChuZXdVbml4ICogMTAwMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgdGhlIHBpeGVscyBwZXIgbWludXRlXHJcbiAqIEBwYXJhbSB7bW9tZW50fSB2aXNfc3RhcnQgVGhlIG1vbWVudCBzcGVjaWZ5aW5nIHRoZSBzdGFydCBvZiB0aGUgdmlzaWJsZSB0aW1lbGluZSByYW5nZVxyXG4gKiBAcGFyYW0ge21vbWVudH0gdmlzX2VuZCBUaGUgbW9tZW50IHNwZWNpZnlpbmcgdGhlIGVuZCBvZiB0aGUgdmlzaWJsZSB0aW1lbGluZSByYW5nZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gdG90YWxfd2lkdGggVGhlIHdpZHRoIG9mIHRoZSB0aW1lbGluZSBpbiBwaXhlbHNcclxuICogQHJldHVybnMge2Zsb2F0fSBUaGUgcGl4ZWxzIHBlciBtaW51dGVcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwaXhlbHNQZXJNaW51dGUodmlzX3N0YXJ0LCB2aXNfZW5kLCB0b3RhbF93aWR0aCkge1xyXG4gIGNvbnN0IHN0YXJ0X2VuZF9taW4gPSB2aXNfZW5kLmRpZmYodmlzX3N0YXJ0LCAnbWludXRlcycpO1xyXG4gIHJldHVybiB0b3RhbF93aWR0aCAvIHN0YXJ0X2VuZF9taW47XHJcbn1cclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0ge251bWJlcn0gZGVsdGEgdGhlIGRlbHRhIGRpc3RhbmNlIGluIHBpeGVsc1xyXG4gKiBAcGFyYW0ge21vbWVudH0gdmlzX3N0YXJ0IHRoZSB2aXNpYmxlIHN0YXJ0IG9mIHRoZSB0aW1lbGluZVxyXG4gKiBAcGFyYW0ge21vbWVudH0gdmlzX2VuZCAgdGhlIHZpc2libGUgZW5kIG9mIHRoZSB0aW1lbGluZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gdG90YWxfd2lkdGggIHRoZSBwaXhlbCB3aWR0aCBvZiB0aGUgdGltZWxpbmVcclxuICogQHBhcmFtIHtudW1iZXJ9IHNuYXBNaW51dGVzIHRoZSBudW1iZXIgb2YgbWludXRlcyB0byBzbmFwIHRvXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U25hcFBpeGVsRnJvbURlbHRhKGRlbHRhLCB2aXNfc3RhcnQsIHZpc19lbmQsIHRvdGFsX3dpZHRoLCBzbmFwTWludXRlcyA9IDApIHtcclxuICBjb25zdCBwaXhlbHNQZXJTbmFwU2VnbWVudCA9IHBpeGVsc1Blck1pbnV0ZSh2aXNfc3RhcnQsIHZpc19lbmQsIHRvdGFsX3dpZHRoKSAqIHNuYXBNaW51dGVzO1xyXG4gIHJldHVybiBNYXRoLnJvdW5kKGRlbHRhIC8gcGl4ZWxzUGVyU25hcFNlZ21lbnQpICogcGl4ZWxzUGVyU25hcFNlZ21lbnQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgdGhlIHRpbWUgYXQgYSBwaXhlbCBsb2NhdGlvblxyXG4gKiBAcGFyYW0ge251bWJlcn0gcGl4ZWxfbG9jYXRpb24gdGhlIHBpeGVsIGxvY2F0aW9uIChnZW5lcmFsbHkgZnJvbSBsZWZ0IGNzcyBzdHlsZSlcclxuICogQHBhcmFtIHttb21lbnR9IHZpc19zdGFydCBUaGUgdmlzaWJsZSBzdGFydCBvZiB0aGUgdGltZWxpbmVcclxuICogQHBhcmFtIHttb21lbnR9IHZpc19lbmQgVGhlIHZpc2libGUgZW5kIG9mIHRoZSB0aW1lbGluZVxyXG4gKiBAcGFyYW0ge251bWJlcn0gdG90YWxfd2lkdGggVGhlIHBpeGVsIHdpZHRoIG9mIHRoZSB0aW1lbGluZSAocm93IHBvcnRpb24pXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzbmFwTWludXRlcyBUaGUgc25hcCByZXNvbHV0aW9uIChpbiBtaW5zKVxyXG4gKiBAcmV0dXJucyB7bW9tZW50fSBNb21lbnQgb2JqZWN0XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGltZUF0UGl4ZWwocGl4ZWxfbG9jYXRpb24sIHZpc19zdGFydCwgdmlzX2VuZCwgdG90YWxfd2lkdGgsIHNuYXBNaW51dGVzID0gMCkge1xyXG4gIGxldCBtaW5fb2Zmc2V0ID0gcGl4ZWxfbG9jYXRpb24gLyBwaXhlbHNQZXJNaW51dGUodmlzX3N0YXJ0LCB2aXNfZW5kLCB0b3RhbF93aWR0aCk7XHJcbiAgbGV0IHRpbWVBdFBpeCA9IHZpc19zdGFydC5jbG9uZSgpLmFkZChtaW5fb2Zmc2V0LCAnbWludXRlcycpO1xyXG4gIGlmIChzbmFwTWludXRlcyAhPT0gMCkgdGltZUF0UGl4ID0gdGltZVNuYXAodGltZUF0UGl4LCBzbmFwTWludXRlcyAqIDYwKTtcclxuICByZXR1cm4gdGltZUF0UGl4O1xyXG59XHJcbi8qKlxyXG4gKiBHZXQgdGhlIHBpeGVsIGxvY2F0aW9uIGF0IGEgc3BlY2lmaWMgdGltZVxyXG4gKiBAcGFyYW0gIHtvYmplY3RzfSB0aW1lIFRoZSB0aW1lIChtb21lbnQpIG9iamVjdFxyXG4gKiBAcGFyYW0gIHttb21lbnR9IHZpc19zdGFydCBUaGUgdmlzaWJsZSBzdGFydCBvZiB0aGUgdGltZWxpbmVcclxuICogQHBhcmFtICB7bW9tZW50fSB2aXNfZW5kIFRoZSB2aXNpYmxlIGVuZCBvZiB0aGUgdGltZWxpbmVcclxuICogQHBhcmFtICB7bnVtYmVyfSB0b3RhbF93aWR0aCBUaGUgd2lkdGggaW4gcGl4ZWxzIG9mIHRoZSBncmlkXHJcbiAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBwaXhlbCBvZmZzZXRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQaXhlbEF0VGltZSh0aW1lLCB2aXNfc3RhcnQsIHZpc19lbmQsIHRvdGFsX3dpZHRoKSB7XHJcbiAgY29uc3QgbWluX2Zyb21fc3RhcnQgPSB0aW1lLmRpZmYodmlzX3N0YXJ0LCAnbWludXRlcycpO1xyXG4gIHJldHVybiBtaW5fZnJvbV9zdGFydCAqIHBpeGVsc1Blck1pbnV0ZSh2aXNfc3RhcnQsIHZpc19lbmQsIHRvdGFsX3dpZHRoKTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyB0aGUgZHVyYXRpb24gZnJvbSB0aGUge0BsaW5rIHZpc19zdGFydH1cclxuICogQHBhcmFtICB7bnVtYmVyfSBwaXhlbHNcclxuICogQHBhcmFtICB7bW9tZW50fSB2aXNfc3RhcnQgVGhlIHZpc2libGUgc3RhcnQgb2YgdGhlIHRpbWVsaW5lXHJcbiAqIEBwYXJhbSAge21vbWVudH0gdmlzX2VuZCBUaGUgdmlzaWJsZSBlbmQgb2YgdGhlIHRpbWVsaW5lXHJcbiAqIEBwYXJhbSAge251bWJlcn0gdG90YWxfd2lkdGggVGhlIHdpZHRoIGluIHBpeGVscyBvZiB0aGUgZ3JpZFxyXG4gKiBAcmV0dXJucyB7bW9tZW50fSBNb21lbnQgZHVyYXRpb25cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREdXJhdGlvbkZyb21QaXhlbHMocGl4ZWxzLCB2aXNfc3RhcnQsIHZpc19lbmQsIHRvdGFsX3dpZHRoKSB7XHJcbiAgY29uc3Qgc3RhcnRfZW5kX21pbiA9IHZpc19lbmQuZGlmZih2aXNfc3RhcnQsICdtaW51dGVzJyk7XHJcbiAgaWYgKHN0YXJ0X2VuZF9taW4gPT09IDApIHJldHVybiBtb21lbnQuZHVyYXRpb24oMCwgJ21pbnV0ZXMnKTtcclxuICBjb25zdCBwaXhlbHNfcGVyX21pbiA9IHRvdGFsX3dpZHRoIC8gc3RhcnRfZW5kX21pbjtcclxuICBsZXQgbWlucyA9IHBpeGVscyAvIHBpeGVsc19wZXJfbWluO1xyXG4gIHJldHVybiBtb21lbnQuZHVyYXRpb24obWlucywgJ21pbnV0ZXMnKTtcclxufVxyXG4iXX0=